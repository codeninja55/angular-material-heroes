# Tutorial: HTTP continued...

| REFERENCE                                |
| ---------------------------------------- |
| [1]: https://angular.io/tutorial/toh-pt6#update-heroes "Update heroes" |

#### Update heroes

Editing a hero's name in the *hero detail* view. As you type, the hero name updates the heading at the top of the page. But when you click the "go back button", the changes are lost.

If you want changes to persist, you must write them back to the server.

At the end of the hero detail template, add a save button with a `click` event binding that invokes a new component method named `save()`.

###### src/app/hero-detail/hero-detail.component.html

```html
...

<div class="row" *ngIf="hero">
  <div class="col-sm-8 offset-sm-2 mt-3">
    <mat-card class="mat-elevation-z3 mat-typography">
      <mat-card-header>
        ...
      </mat-card-header>
      <mat-card-content>
        ...
      </mat-card-content>
      <mat-card-actions align="start">
        <button mat-button class="red-text text-lighten-2" (click)="save()">
          <mat-icon>
            save
          </mat-icon>
          &nbsp;SAVE
        </button>
        <button mat-button class="red-text text-lighten-2">
          <mat-icon>plus_one</mat-icon>
          &nbsp;LIKE
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  ...
</div>
```

Add the following `save()` method, which persists hero name changes using the hero service `updateHero()` method and then navigates back to the previous view.

###### src/app/hero-detail/hero-detail.component.ts

```typescript
...

export class HeroDetailComponent implements OnInit {

  ...

  goBack(): void {
    this.location.back();
  }

  save(): void {
    this.heroService.updateHero(this.hero).subscribe(() => this.goBack());
  }
}

```



#### Add *HeroService.updateHero()*

The overall structure of the `updateHero()` method is similar to that of `getHeroes()`, but it uses `http.put()` to persist the changed hero on the server.

###### src/app/hero.service.ts

```typescript
...

import { HttpClient, HttpHeaders } from '@angular/common/http';
import {catchError, tap} from 'rxjs/operators';

const httpOptions = {
  headers: new HttpHeaders({ 'Content-Type': 'application/json' })
};

@Injectable()
export class HeroService {

  ...

  /** PUT: update the hero on the server */
  updateHero(hero: Hero): Observable<any> {
    return this.http.put(this.heroesUrl, hero, httpOptions)
      .pipe(
        tap(() => this.log(`updated hero id=${hero.id}`)),
        catchError(this.handleError<any>('updateHero'))
      );
  }

  ...
}

```

The `HttpClient.put()` method takes three parameters

- the URL
- the data to update (the modified hero in this case)
- options

The URL is unchanged. The heroes web API knows which hero to update by looking at the hero's `id`.

The heroes web API expects a special header in HTTP save requests. That header is in the `httpOptions` constant defined in the `HeroService`.

Refresh the browser, change a hero name, save your change, and click the "go back" button. The hero now appears in the list with the changed name.



#### Add a new hero

To add a hero, we are going to make a simple `HeroFormComponent` which will allow us to define more `<input>`'s' than just the name.

##### Make the `HeroFormComponent`

```bash
$ ng g component hero-form --module=app.module
```

##### Add a route to the `HeroFormComponent`

###### src/app/app-routing.module.ts

```typescript
...

import { HeroFormComponent } from './hero-form/hero-form.component';

const routes: Routes = [
  ...

  { path: 'hero/add', component: HeroFormComponent },
  { path: 'hero/:id', component: HeroDetailComponent },
  { path: '', redirectTo: '/dashboard', pathMatch: 'full' }
];

@NgModule({
  imports: [ RouterModule.forRoot(routes) ],
  exports: [ RouterModule ]
})

export class AppRoutingModule { }

```

> *NOTE:* The order of the routes are important. If you add the 'hero/add' path after the 'hero/:id', the router will try to resolve '/add' as an ID and will throw an error.

##### Import the `MatFormFieldModule`

At this point, we have many imports from Angular Material. We can create a single module that imports all of these for us and then reference it in the `app.module.ts` to make them available to all components. This module will import all required Angular Material modules and then export them to be used in our application.

Make a new `material.module.ts`:

###### src/app/material.module.ts

```typescript
import { NgModule } from '@angular/core';

import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import {FormsModule, ReactiveFormsModule} from '@angular/forms';
import {
  MatAutocompleteModule,
  MatButtonModule,
  MatButtonToggleModule,
  MatCardModule,
  MatCheckboxModule,
  MatChipsModule,
  MatDatepickerModule,
  MatDialogModule,
  MatExpansionModule,
  MatGridListModule,
  MatIconModule,
  MatInputModule,
  MatListModule,
  MatMenuModule,
  MatNativeDateModule,
  MatPaginatorModule,
  MatProgressBarModule,
  MatProgressSpinnerModule,
  MatRadioModule,
  MatRippleModule,
  MatSelectModule,
  MatSidenavModule,
  MatSliderModule,
  MatSlideToggleModule,
  MatSnackBarModule,
  MatSortModule,
  MatTableModule,
  MatTabsModule,
  MatToolbarModule,
  MatTooltipModule,
  MatStepperModule,
  MAT_PLACEHOLDER_GLOBAL_OPTIONS,
} from '@angular/material';

import { MatFormFieldModule } from '@angular/material/form-field';
import { CdkTableModule } from '@angular/cdk/table';


@NgModule({
  imports: [
    BrowserAnimationsModule,
    CdkTableModule,
    MatAutocompleteModule,
    MatButtonModule,
    MatButtonToggleModule,
    MatCardModule,
    MatCheckboxModule,
    MatChipsModule,
    MatDatepickerModule,
    MatDialogModule,
    MatExpansionModule,
    MatGridListModule,
    MatIconModule,
    MatInputModule,
    MatListModule,
    MatMenuModule,
    MatNativeDateModule,
    MatPaginatorModule,
    MatProgressBarModule,
    MatProgressSpinnerModule,
    MatRadioModule,
    MatRippleModule,
    MatSelectModule,
    MatSidenavModule,
    MatSliderModule,
    MatSlideToggleModule,
    MatSnackBarModule,
    MatSortModule,
    MatTableModule,
    MatTabsModule,
    MatToolbarModule,
    MatTooltipModule,
    MatStepperModule,
    MatFormFieldModule,
    FormsModule,
    ReactiveFormsModule,
  ],
  exports: [
    BrowserAnimationsModule,
    CdkTableModule,
    MatAutocompleteModule,
    MatButtonModule,
    MatButtonToggleModule,
    MatCardModule,
    MatCheckboxModule,
    MatChipsModule,
    MatDatepickerModule,
    MatDialogModule,
    MatExpansionModule,
    MatGridListModule,
    MatIconModule,
    MatInputModule,
    MatListModule,
    MatMenuModule,
    MatNativeDateModule,
    MatPaginatorModule,
    MatProgressBarModule,
    MatProgressSpinnerModule,
    MatRadioModule,
    MatRippleModule,
    MatSelectModule,
    MatSidenavModule,
    MatSliderModule,
    MatSlideToggleModule,
    MatSnackBarModule,
    MatSortModule,
    MatTableModule,
    MatTabsModule,
    MatToolbarModule,
    MatTooltipModule,
    MatStepperModule,
    MatFormFieldModule,
    FormsModule,
    ReactiveFormsModule,
  ],
  providers: [
    {provide: MAT_PLACEHOLDER_GLOBAL_OPTIONS, useValue: {float: 'auto'}}
  ]
})

export class MaterialModule { }
```

Then you will need to import this new module in our application such as:

###### src/app/app.module.ts

```typescript
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { FormsModule } from '@angular/forms';

// All Angular Material Modules imported at once
import { MaterialModule } from './material.module';

import { AppComponent } from './app.component';
import { MatNavbarComponent  } from './mat-navbar/mat-navbar.component';
import { HeroesComponent } from './heroes/heroes.component';
import { HeroDetailComponent } from './hero-detail/hero-detail.component';
import { HeroService } from './hero.service';
import { MessageService } from './message.service';
import { AppRoutingModule } from './app-routing.module';
import { DashboardComponent } from './dashboard/dashboard.component';
import { HttpClientModule } from '@angular/common/http';
import { HttpClientInMemoryWebApiModule } from 'angular-in-memory-web-api';
import { InMemoryDataService } from './in-memory-data.service';
import { HeroFormComponent } from './hero-form/hero-form.component';

@NgModule({
  declarations: [
    AppComponent,
    MatNavbarComponent,
    HeroesComponent,
    HeroDetailComponent,
    DashboardComponent,
    HeroFormComponent,
  ],
  imports: [
    BrowserModule,
    MaterialModule,
    FormsModule,
    AppRoutingModule,
    HttpClientModule,

    // The HttpClientInMemoryWebApiModule module intercepts HTTP requests
    // and returns simulated server responses.
    // Remove it when a real server is ready to receive requests.
    HttpClientInMemoryWebApiModule.forRoot(
      InMemoryDataService, { dataEncapsulation: false }
    ),
  ],
  entryComponents: [],
  providers: [ HeroService, MessageService ],
  bootstrap: [ AppComponent ]
})

export class AppModule { }
```

##### Create the form with Angular Material Form controls

###### src/app/hero-form/hero-form.component.html

```html
<div class="col align-middle align-content-center red lighten-1 py-5">
  <h1 class="mat-display-1 text-center white-text mb-0">Add a new Hero</h1>
</div>

<div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-sm-10 offset-sm-1 mt-3">
  <mat-card class="mat-elevation-z3 mat-typography">
    <mat-card-title><h3>Hero Form</h3></mat-card-title>
    <mat-card-subtitle><h4>Let's add a new Marvel Hero.</h4></mat-card-subtitle>

    <mat-card-content>
      <mat-form-field class="d-inline-flex flex-column w-100 mt-2" hintLabel="The name the here prefers to be called.">
        <input matInput #name placeholder="Hero Name" required>
      </mat-form-field>
      <mat-form-field class="d-inline-flex flex-column w-100 mt-3">
        <input matInput #realName placeholder="Real Name">
        <mat-hint>The real name of the hero.</mat-hint>
      </mat-form-field>
      <mat-form-field class="d-inline-flex flex-column w-100 mt-4">
        <textarea matInput #powers placeholder="Hero Powers"></textarea>
        <mat-hint>The super powers the hero possesses.</mat-hint>
      </mat-form-field>
      <mat-form-field class="d-inline-flex flex-column w-100 mt-4">
        <textarea matInput #abilities placeholder="Hero Abilities"></textarea>
        <mat-hint>Other abilities this hero possesses.</mat-hint>
      </mat-form-field>
      <button mat-button class="mt-3 red-text text-lighten-2" routerLink="/heroes"
              (click)="add(name.value, realName.value, powers.value, abilities.value)">
        <mat-icon>send</mat-icon>
        &nbsp;Add
      </button>
      <button mat-button class="mt-3 red-text text-lighten-2"
              (click)="name.value=''; realname.value=''; abilities.value=''; powers.value=''">
        <mat-icon>clear</mat-icon>
        &nbsp;Clear
      </button>
    </mat-card-content>
  </mat-card>
</div>

<div class="col-4 offset-4 mt-4 text-center">
  <button mat-fab class="mat-fab white-text" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>
</div>
```
###### src/app/hero-form/hero-form.component.ts

```typescript
import { Component, OnInit } from '@angular/core';
import { Location } from '@angular/common';
import { HeroService } from '../hero.service';
import { Hero } from '../hero';

@Component({
  selector: 'app-hero-form',
  templateUrl: './hero-form.component.html',
  styleUrls: ['./hero-form.component.css']
})
export class HeroFormComponent implements OnInit {

  constructor(
    private heroService: HeroService,
    private location: Location,
  ) { }

  ngOnInit() { }

  goBack(): void {
    this.location.back();
  }

  add(name: string, realName?: string, powers?: string, abilities?: string) {
    name = name.trim();
    realName = name.trim();
    if (!name) { return; }
    const hero = new Hero(name, realName, powers, abilities);
    console.log(hero);
    this.heroService.addHero(hero)
      .subscribe((newHero: Hero) => console.log(newHero));
  }
}
```

#### Add HeroService.addHero()

Add the following `addHero()`` method to the HeroService class.
###### src/app/hero.service.ts
```typescript
...

@Injectable()
export class HeroService {
  private heroesUrl = 'api/heroes';  // URL to web api

...

  /** POST: add a new hero to the server */
  addHero(hero: Hero): Observable<Hero> {
    return this.http.post<Hero>(this.heroesUrl, hero, httpOptions)
      .pipe(
        tap((newHero: Hero) => this.log(`added hero w/ id=${newHero.id}`)),
        catchError(this.handleError<Hero>('addHero'))
      );
  }

...
```
